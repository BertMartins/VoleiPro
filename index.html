<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoleiPro - Gest√£o de Jogos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-orange: #FF6B35;
            --primary-blue: #1E40AF;
            --secondary-yellow: #F59E0B;
            --dark-bg: #0F172A;
            --card-bg: #1E293B;
        }

        * {
            font-family: 'Poppins', sans-serif;
        }

        .title-font {
            font-family: 'Bebas Neue', cursive;
        }

        body {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            min-height: 100vh;
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .animate-slideIn {
            animation: slideIn 0.3s ease-out forwards;
        }

        .animate-bounce {
            animation: bounce 2s infinite;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        /* Gradientes */
        .gradient-orange {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        .gradient-blue {
            background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
        }

        .gradient-yellow {
            background: linear-gradient(135deg, #F59E0B 0%, #FCD34D 100%);
        }

        /* Cards com efeito glass */
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Bot√µes personalizados */
        .btn-primary {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.3);
        }

        /* Input estilizado */
        .custom-input {
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .custom-input:focus {
            border-color: #FF6B35;
            background: rgba(30, 41, 59, 0.8);
            outline: none;
        }

        /* Badge de n√≠vel */
        .level-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .level-1 { background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%); }
        .level-2 { background: linear-gradient(135deg, #22C55E 0%, #4ADE80 100%); }
        .level-3 { background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%); }
        .level-4 { background: linear-gradient(135deg, #A855F7 0%, #C084FC 100%); }
        .level-5 { background: linear-gradient(135deg, #F59E0B 0%, #FCD34D 100%); }
        .level-6 { background: linear-gradient(135deg, #EF4444 0%, #F87171 100%); }

        /* Placar */
        .score-display {
            font-size: 4rem;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Loading */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #FF6B35;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsivo */
        @media (max-width: 640px) {
            .score-display {
                font-size: 3rem;
            }
        }

        /* Esconder scrollbar mas manter funcionalidade */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Radio button customizado para n√≠veis */
        input[type="radio"]:checked + .level-badge {
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.5);
        }

        /* Bot√£o de ajuda flutuante */
        .help-button {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 40;
        }

        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(255, 107, 53, 0.6);
        }

        .help-button:active {
            transform: scale(0.95);
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        .help-button.animate-shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body class="h-full">
    <div id="app" class="h-full"></div>

    <script>
        // ============================================
        // SISTEMA DE DADOS (Mockado em mem√≥ria)
        // ============================================
        const AppState = {
            currentUser: null,
            currentView: 'login',
            users: [
                { id: 1, name: 'Heberte Martins', email: 'heberteuallan1@gmail.com', password: '@Martins', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 2, name: 'Dourivan', email: 'dourivan@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 3, name: 'Mayara Chagas', email: 'mayara@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 4, name: 'Sr. Rodrigues', email: 'rodrigues@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 5, name: 'Beatriz Carvalho', email: 'beatriz@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 6, name: 'Marcelo', email: 'marcelo@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 7, name: 'Diogo', email: 'diogo@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 8, name: 'Renata Cryslaine', email: 'renata@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 9, name: 'Julia Bomfim', email: 'Julia@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 10, name: 'Kevin Ouro', email: 'Kevin@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 11, name: 'Gustavo', email: 'Gustavo@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 12, name: 'Lucas Dias', email: 'Lucas@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 13, name: 'Lohane', email: 'Lohane@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 14, name: 'Lowren', email: 'Lowren@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },
                { id: 15, name: 'Luan Compadre', email: 'Luan@gmail.com', password: '123456', role: 'admin', level: 5, photo: 'üë®‚Äçüíº', paymentType: 'monthly', stats: { wins: 0, losses: 0, championships: 0 }, monthlyPayments: {} },

            ],
            games: [

            ],
            currentGame: null,
            currentMatch: null,
            activeMatch: null,
            teams: [],
            matchHistory: [],
            monthlyFees: {} // { '2025-01': 600, '2025-02': 600 }
        };

        // ============================================
        // FUN√á√ïES DE COOKIES
        // ============================================
        function setCookie(name, value, days = 7) {
            const expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
            document.cookie = `${name}=${encodeURIComponent(JSON.stringify(value))};expires=${expires.toUTCString()};path=/;SameSite=Lax`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) {
                    try {
                        return JSON.parse(decodeURIComponent(c.substring(nameEQ.length, c.length)));
                    } catch (e) {
                        return null;
                    }
                }
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
        }

        function saveState() {
            setCookie('voleiProUser', AppState.currentUser);
            setCookie('voleiProUsers', AppState.users);
            setCookie('voleiProGames', AppState.games);
            setCookie('voleiProActiveMatch', AppState.activeMatch);
            setCookie('voleiProTeams', AppState.teams);
            setCookie('voleiProCurrentGame', AppState.currentGame);
            setCookie('voleiProMatchHistory', AppState.matchHistory);
            setCookie('voleiProMonthlyFees', AppState.monthlyFees);
        }

        function loadState() {
            const user = getCookie('voleiProUser');
            const users = getCookie('voleiProUsers');
            const games = getCookie('voleiProGames');
            const activeMatch = getCookie('voleiProActiveMatch');
            const teams = getCookie('voleiProTeams');
            const currentGame = getCookie('voleiProCurrentGame');
            const matchHistory = getCookie('voleiProMatchHistory');
            const monthlyFees = getCookie('voleiProMonthlyFees');

            if (user) {
                // Migra√ß√£o do usu√°rio atual
                if (!user.paymentType) user.paymentType = 'monthly';
                if (!user.monthlyPayments) user.monthlyPayments = {};
                AppState.currentUser = user;
            }
            if (users && users.length > 0) {
                // Migra√ß√£o: garantir que todos os usu√°rios tenham os novos campos
                AppState.users = users.map(u => {
                    if (!u.paymentType) u.paymentType = 'monthly';
                    if (!u.monthlyPayments) u.monthlyPayments = {};
                    return u;
                });
            }
            if (games && games.length > 0) AppState.games = games;
            if (activeMatch) AppState.activeMatch = activeMatch;
            if (teams && teams.length > 0) AppState.teams = teams;
            if (currentGame) AppState.currentGame = currentGame;
            if (matchHistory && matchHistory.length > 0) AppState.matchHistory = matchHistory;
            if (monthlyFees) AppState.monthlyFees = monthlyFees;
        }

        // ============================================
        // FUN√á√ïES DE AUTENTICA√á√ÉO
        // ============================================
        function login(email, password) {
            const user = AppState.users.find(u => u.email === email && u.password === password);
            if (user) {
                AppState.currentUser = user;
                saveState();
                navigateTo('dashboard');
                return true;
            }
            return false;
        }

        function logout() {
            AppState.currentUser = null;
            deleteCookie('voleiProUser');
            deleteCookie('voleiProUsers');
            deleteCookie('voleiProGames');
            deleteCookie('voleiProActiveMatch');
            deleteCookie('voleiProTeams');
            deleteCookie('voleiProCurrentGame');
            navigateTo('login');
        }

        function register(name, email, password, paymentType = 'monthly') {
            const newUser = {
                id: AppState.users.length + 1,
                name,
                email,
                password,
                role: 'player',
                level: 3,
                photo: 'üèê',
                paymentType: paymentType,
                stats: { wins: 0, losses: 0, championships: 0 },
                monthlyPayments: {}
            };
            AppState.users.push(newUser);
            AppState.currentUser = newUser;
            saveState();
            navigateTo('dashboard');
        }

        // ============================================
        // FUN√á√ïES DE JOGOS
        // ============================================
        function createGame(date, maxPlayers = 16, teamSize = 6, twoWinsRule = true, pointsPerMatch = 25, cutoffTime = '15:00') {
            const newGame = {
                id: AppState.games.length + 1,
                date,
                status: 'open',
                players: [], // Ser√° array de objetos: { userId, timestamp, paymentType }
                maxPlayers,
                adminId: AppState.currentUser.id,
                teamSize: parseInt(teamSize),
                twoWinsRule: twoWinsRule,
                pointsPerMatch: parseInt(pointsPerMatch),
                matchHistory: [],
                cutoffTime: cutoffTime
            };
            AppState.games.push(newGame);
            saveState();
            return newGame;
        }

        function joinGame(gameId) {
            const game = AppState.games.find(g => g.id === gameId);
            if (!game || game.status !== 'open') return false;

            // Verificar se j√° est√° na lista
            const alreadyJoined = game.players.some(p => (typeof p === 'object' ? p.userId : p) === AppState.currentUser.id);
            if (alreadyJoined) return false;

            // Adicionar jogador com timestamp e tipo de pagamento
            const playerEntry = {
                userId: AppState.currentUser.id,
                timestamp: Date.now(),
                paymentType: AppState.currentUser.paymentType
            };
            game.players.push(playerEntry);

            // Reorganizar lista com prioridade
            reorganizePlayers(game);

            saveState();
            return true;
        }

        function leaveGame(gameId) {
            const game = AppState.games.find(g => g.id === gameId);
            if (game) {
                game.players = game.players.filter(p => {
                    const userId = typeof p === 'object' ? p.userId : p;
                    return userId !== AppState.currentUser.id;
                });

                // Reorganizar lista ap√≥s sa√≠da
                reorganizePlayers(game);

                saveState();
                return true;
            }
            return false;
        }

        // Reorganiza jogadores: mensalistas primeiro (at√© 15h), depois diaristas por ordem
        function reorganizePlayers(game) {
            if (!game.players || game.players.length === 0) return;

            // Converter players antigos (apenas IDs) para novo formato
            game.players = game.players.map(p => {
                if (typeof p === 'number') {
                    const user = AppState.users.find(u => u.id === p);
                    return {
                        userId: p,
                        timestamp: Date.now(),
                        paymentType: user?.paymentType || 'monthly'
                    };
                }
                return p;
            });

            // Verificar se j√° passou do hor√°rio de corte
            const now = new Date();
            const [cutoffHour, cutoffMinute] = (game.cutoffTime || '15:00').split(':').map(Number);
            const gameDate = new Date(game.date);
            const cutoffDateTime = new Date(gameDate);
            cutoffDateTime.setHours(cutoffHour, cutoffMinute, 0, 0);

            const isPastCutoff = now > cutoffDateTime;

            // Separar mensalistas e diaristas
            const monthlyPlayers = game.players.filter(p => p.paymentType === 'monthly');
            const dailyPlayers = game.players.filter(p => p.paymentType === 'daily');

            // Ordenar ambos por timestamp (ordem de inscri√ß√£o)
            monthlyPlayers.sort((a, b) => a.timestamp - b.timestamp);
            dailyPlayers.sort((a, b) => a.timestamp - b.timestamp);

            // Reorganizar baseado no hor√°rio de corte
            if (isPastCutoff) {
                // Ap√≥s 15h: todos por ordem de inscri√ß√£o (j√° ordenados por tipo)
                game.players = [...monthlyPlayers, ...dailyPlayers];
            } else {
                // Antes de 15h: mensalistas primeiro
                game.players = [...monthlyPlayers, ...dailyPlayers];
            }
        }

        function addVisitor(gameId, name, level) {
            const visitor = {
                id: Date.now(),
                name,
                level: parseInt(level),
                photo: 'üë§',
                role: 'visitor',
                paymentType: 'daily', // Visitantes s√£o sempre diaristas
                stats: { wins: 0, losses: 0, championships: 0 },
                monthlyPayments: {}
            };
            AppState.users.push(visitor);

            const game = AppState.games.find(g => g.id === gameId);
            if (game) {
                const playerEntry = {
                    userId: visitor.id,
                    timestamp: Date.now(),
                    paymentType: 'daily'
                };
                game.players.push(playerEntry);
                reorganizePlayers(game);
                saveState();
                return true;
            }
            return false;
        }

        function removePlayerFromGame(gameId, playerId) {
            const game = AppState.games.find(g => g.id === gameId);
            if (game) {
                game.players = game.players.filter(p => {
                    const userId = typeof p === 'object' ? p.userId : p;
                    return userId !== playerId;
                });
                reorganizePlayers(game);
                saveState();
                return true;
            }
            return false;
        }

        // Fun√ß√£o auxiliar para obter jogadores de um jogo no novo formato
        function getGamePlayers(game) {
            if (!game || !game.players) return [];

            return game.players.map(p => {
                const userId = typeof p === 'object' ? p.userId : p;
                const user = AppState.users.find(u => u.id === userId);
                if (user) {
                    return {
                        ...user,
                        timestamp: typeof p === 'object' ? p.timestamp : Date.now(),
                        paymentType: typeof p === 'object' ? p.paymentType : (user.paymentType || 'monthly')
                    };
                }
                return null;
            }).filter(Boolean);
        }

        // Separa jogadores entre lista principal e suplentes
        function splitMainAndReserve(game) {
            const allPlayers = getGamePlayers(game);
            const mainPlayers = allPlayers.slice(0, game.maxPlayers);
            const reservePlayers = allPlayers.slice(game.maxPlayers);

            return { mainPlayers, reservePlayers };
        }

        // ============================================
        // FUN√á√ïES DE TIMES
        // ============================================
        function createBalancedTeams(playerIds, teamSize = 6) {
            const players = playerIds.map(id => AppState.users.find(u => u.id === id)).filter(Boolean);

            // Calcular n√∫mero de times baseado no tamanho do time
            const numTeams = Math.floor(players.length / teamSize);

            // Ordenar por n√≠vel
            players.sort((a, b) => b.level - a.level);

            // Nomes e cores dos times
            const teamConfigs = [
                { name: 'Vermelho', color: '#EF4444' },
                { name: 'Azul', color: '#3B82F6' },
                { name: 'Verde', color: '#10B981' },
                { name: 'Preto', color: '#1F2937' }
            ];

            // Criar apenas o n√∫mero necess√°rio de times
            const teams = [];
            for (let i = 0; i < numTeams; i++) {
                teams.push({
                    name: teamConfigs[i].name,
                    color: teamConfigs[i].color,
                    players: []
                });
            }

            // Distribuir jogadores de forma balanceada
            players.forEach((player, index) => {
                teams[index % numTeams].players.push(player);
            });

            AppState.teams = teams;
            saveState();
            return teams;
        }

        // ============================================
        // NAVEGA√á√ÉO
        // ============================================
        function navigateTo(view, data = null) {
            AppState.currentView = view;
            if (data) {
                if (view === 'game-detail') AppState.currentGame = data;
                if (view === 'match') AppState.currentMatch = data;
            }
            render();
        }

        // ============================================
        // COMPONENTES DE UI
        // ============================================

        // Tela de Login
        function LoginScreen() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4 animate-fadeIn">
                    <div class="w-full max-w-md">
                        <!-- Logo -->
                        <div class="text-center mb-8 animate-bounce">
                            <div class="inline-block text-6xl mb-4">üèê</div>
                            <h1 class="title-font text-5xl text-white mb-2">VOLEIPRO</h1>
                            <p class="text-gray-400">Gest√£o Profissional de Jogos</p>
                        </div>

                        <!-- Card de Login -->
                        <div class="glass-card rounded-2xl p-8 shadow-2xl">
                            <form onsubmit="handleLogin(event)" class="space-y-6">
                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        <i class="fas fa-envelope mr-2"></i>Email
                                    </label>
                                    <input type="email" id="login-email" required
                                        class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                        placeholder="seu@email.com" value="admin@volei.com">
                                </div>

                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        <i class="fas fa-lock mr-2"></i>Senha
                                    </label>
                                    <input type="password" id="login-password" required
                                        class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="123">
                                </div>

                                <button type="submit"
                                    class="btn-primary w-full py-3 rounded-lg text-white font-bold text-lg">
                                    ENTRAR
                                </button>
                            </form>

                            <div class="mt-6 text-center">
                                <button onclick="navigateTo('register')"
                                    class="text-orange-400 hover:text-orange-300 font-medium">
                                    N√£o tem conta? Cadastre-se
                                </button>
                            </div>

                            <div class="mt-6 pt-6 border-t border-gray-700">
                                <p class="text-gray-400 text-sm text-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Use: admin@volei.com / 123
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Tela de Registro
        function RegisterScreen() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4 animate-fadeIn">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-6">
                            <button onclick="navigateTo('login')"
                                class="text-gray-400 hover:text-white mb-4">
                                <i class="fas fa-arrow-left mr-2"></i>Voltar
                            </button>
                            <h1 class="title-font text-4xl text-white mb-2">CRIAR CONTA</h1>
                        </div>

                        <div class="glass-card rounded-2xl p-8 shadow-2xl">
                            <form onsubmit="handleRegister(event)" class="space-y-5">
                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        <i class="fas fa-user mr-2"></i>Nome Completo
                                    </label>
                                    <input type="text" id="reg-name" required
                                        class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                        placeholder="Jo√£o Silva">
                                </div>

                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        <i class="fas fa-envelope mr-2"></i>Email
                                    </label>
                                    <input type="email" id="reg-email" required
                                        class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                        placeholder="seu@email.com">
                                </div>

                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        <i class="fas fa-lock mr-2"></i>Senha
                                    </label>
                                    <input type="password" id="reg-password" required
                                        class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>

                                <div>
                                    <label class="block text-white font-medium mb-3">
                                        <i class="fas fa-wallet mr-2"></i>Tipo de Pagamento
                                    </label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <label class="cursor-pointer">
                                            <input type="radio" name="payment-type" value="monthly" checked class="hidden peer">
                                            <div class="bg-gray-700/50 peer-checked:bg-orange-500/30 peer-checked:border-orange-500 border-2 border-gray-600 rounded-lg p-4 text-center transition">
                                                <i class="fas fa-calendar-alt text-2xl mb-2 text-orange-400"></i>
                                                <div class="text-white font-bold">Mensalista</div>
                                                <div class="text-gray-400 text-xs">Pagamento mensal</div>
                                            </div>
                                        </label>
                                        <label class="cursor-pointer">
                                            <input type="radio" name="payment-type" value="daily" class="hidden peer">
                                            <div class="bg-gray-700/50 peer-checked:bg-blue-500/30 peer-checked:border-blue-500 border-2 border-gray-600 rounded-lg p-4 text-center transition">
                                                <i class="fas fa-ticket-alt text-2xl mb-2 text-blue-400"></i>
                                                <div class="text-white font-bold">Diarista</div>
                                                <div class="text-gray-400 text-xs">Pagamento por jogo</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <button type="submit"
                                    class="btn-primary w-full py-3 rounded-lg text-white font-bold text-lg">
                                    CRIAR CONTA
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }

        // Dashboard Principal
        function DashboardScreen() {
            const openGames = AppState.games.filter(g => g.status === 'open');
            const isAdmin = AppState.currentUser?.role === 'admin';

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <!-- Header -->
                    <div class="gradient-orange p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="text-4xl">${AppState.currentUser.photo}</div>
                                <div>
                                    <h2 class="text-white font-bold text-xl">${AppState.currentUser.name}</h2>
                                    <p class="text-orange-100 text-sm">
                                        <i class="fas fa-trophy mr-1"></i>
                                        ${AppState.currentUser.stats.championships} T√≠tulos
                                    </p>
                                </div>
                            </div>
                            <button onclick="logout()" class="text-white hover:bg-white/20 p-2 rounded-lg transition">
                                <i class="fas fa-sign-out-alt text-xl"></i>
                            </button>
                        </div>

                        <!-- Stats R√°pidas -->
                        <div class="grid grid-cols-3 gap-3 mt-4">
                            <div class="bg-white/10 backdrop-blur rounded-lg p-3 text-center">
                                <div class="level-badge level-${AppState.currentUser.level} mx-auto mb-1">
                                    ${AppState.currentUser.level}
                                </div>
                                <p class="text-white text-xs">N√≠vel</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-white">${AppState.currentUser.stats.wins}</div>
                                <p class="text-white text-xs">Vit√≥rias</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-white">
                                    ${Math.round((AppState.currentUser.stats.wins / (AppState.currentUser.stats.wins + AppState.currentUser.stats.losses)) * 100)}%
                                </div>
                                <p class="text-white text-xs">Taxa</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Bot√µes Admin -->
                        ${isAdmin ? `
                            <div class="space-y-3">
                                <button onclick="showCreateGameModal()"
                                    class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg">
                                    <i class="fas fa-plus-circle mr-2"></i>CRIAR NOVO JOGO
                                </button>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="navigateTo('users')"
                                        class="btn-secondary w-full py-4 rounded-xl text-white font-bold shadow-lg">
                                        <i class="fas fa-users-cog mr-2"></i>USU√ÅRIOS
                                    </button>
                                    <button onclick="navigateTo('payments')"
                                        class="bg-green-600 hover:bg-green-700 w-full py-4 rounded-xl text-white font-bold shadow-lg">
                                        <i class="fas fa-wallet mr-2"></i>MENSALIDADES
                                    </button>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Jogos Abertos -->
                        <div>
                            <h3 class="text-white font-bold text-xl mb-4">
                                <i class="fas fa-calendar-check mr-2 text-orange-400"></i>
                                Jogos Dispon√≠veis
                            </h3>
                            <div class="space-y-4">
                                ${openGames.length > 0 ? openGames.map(game => GameCard(game)).join('') :
                                    '<p class="text-gray-400 text-center py-8">Nenhum jogo dispon√≠vel no momento</p>'}
                            </div>
                        </div>

                        <!-- √öltimos Resultados -->
                        <div>
                            <h3 class="text-white font-bold text-xl mb-4">
                                <i class="fas fa-trophy mr-2 text-yellow-400"></i>
                                √öltimos Campe√µes
                            </h3>
                            ${AppState.games.filter(g => g.status === 'finished').slice(-3).reverse().map(game => `
                                <div class="glass-card rounded-xl p-4 mb-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="text-yellow-400 font-bold text-lg">
                                                <i class="fas fa-crown mr-2"></i>${game.champion}
                                            </div>
                                            <div class="text-gray-400 text-sm">${game.date}</div>
                                        </div>
                                        <div class="text-3xl">üèÜ</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Bottom Navigation -->
                    ${BottomNav('dashboard')}
                </div>
            `;
        }

        // Card de Jogo
        function GameCard(game) {
            const isJoined = game.players.includes(AppState.currentUser.id);
            const isFull = game.players.length >= game.maxPlayers;
            const isInProgress = game.status === 'in_progress';

            return `
                <div class="glass-card rounded-xl p-5 shadow-lg hover:shadow-2xl transition ${isInProgress ? 'border-2 border-green-500' : ''}">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <div class="text-white font-bold text-lg mb-1">
                                <i class="fas fa-calendar mr-2 text-orange-400"></i>
                                ${new Date(game.date).toLocaleDateString('pt-BR')}
                            </div>
                            <div class="text-gray-400 text-sm">
                                <i class="fas fa-users mr-2"></i>
                                ${game.players.length}/${game.maxPlayers} jogadores
                            </div>
                            ${isInProgress ? `
                                <div class="text-green-400 text-sm font-bold mt-1">
                                    <i class="fas fa-play-circle mr-1 animate-pulse"></i>
                                    Jogo em Andamento
                                </div>
                            ` : ''}
                        </div>
                        <div class="text-3xl animate-bounce">üèê</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="bg-gray-700 rounded-full h-2 mb-4">
                        <div class="${isInProgress ? 'bg-green-500' : 'gradient-orange'} h-2 rounded-full transition-all duration-500"
                            style="width: ${(game.players.length / game.maxPlayers) * 100}%"></div>
                    </div>

                    <div class="flex gap-2">
                        ${!isJoined && !isFull && !isInProgress ? `
                            <button onclick="handleJoinGame(${game.id})"
                                class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-user-plus mr-2"></i>PARTICIPAR
                            </button>
                        ` : ''}

                        ${isJoined && !isInProgress ? `
                            <button onclick="handleLeaveGame(${game.id})"
                                class="bg-red-500 hover:bg-red-600 flex-1 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-user-minus mr-2"></i>SAIR
                            </button>
                        ` : ''}

                        ${isInProgress && isFull ? `
                            <div class="flex-1 bg-yellow-500/20 border border-yellow-500 py-3 px-4 rounded-lg text-yellow-300 text-center font-bold text-sm">
                                <i class="fas fa-lock mr-2"></i>Lista Fechada
                            </div>
                        ` : ''}

                        <button onclick="navigateTo('game-detail', ${JSON.stringify(game).replace(/"/g, '&quot;')})"
                            class="btn-secondary px-6 py-3 rounded-lg text-white font-bold">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // Detalhes do Jogo
        function GameDetailScreen() {
            const game = AppState.currentGame;
            const isAdmin = AppState.currentUser?.role === 'admin';
            const { mainPlayers, reservePlayers } = splitMainAndReserve(game);
            const players = [...mainPlayers, ...reservePlayers];

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <!-- Header -->
                    <div class="gradient-blue p-6">
                        <button onclick="navigateTo('dashboard')"
                            class="text-white mb-4 hover:bg-white/20 px-3 py-2 rounded-lg transition">
                            <i class="fas fa-arrow-left mr-2"></i>Voltar
                        </button>
                        <h1 class="title-font text-3xl text-white mb-2">DETALHES DO JOGO</h1>
                        <p class="text-blue-100">
                            <i class="fas fa-calendar mr-2"></i>
                            ${new Date(game.date).toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </p>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Status do Jogo -->
                        ${game.status === 'in_progress' ? `
                            <div class="bg-green-500/20 border-2 border-green-500 rounded-xl p-4 text-center animate-pulse">
                                <i class="fas fa-play-circle text-green-400 text-3xl mb-2"></i>
                                <div class="text-green-300 font-bold text-lg">JOGO EM ANDAMENTO</div>
                                <div class="text-green-400 text-sm">A lista de participantes est√° bloqueada</div>
                            </div>
                        ` : ''}

                        <!-- Configura√ß√µes do Jogo -->
                        <div class="glass-card rounded-xl p-5">
                            <h3 class="text-white font-bold text-lg mb-3">
                                <i class="fas fa-cog mr-2 text-orange-400"></i>
                                Configura√ß√µes
                            </h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-blue-500/20 border border-blue-500 rounded-lg p-3 text-center">
                                    <div class="text-2xl font-bold text-blue-400">${game.teamSize}</div>
                                    <div class="text-gray-300 text-xs">Jogadores/Time</div>
                                </div>
                                <div class="bg-${game.twoWinsRule && game.players.length >= game.teamSize * 4 ? 'green' : 'gray'}-500/20 border border-${game.twoWinsRule && game.players.length >= game.teamSize * 4 ? 'green' : 'gray'}-500 rounded-lg p-3 text-center">
                                    <i class="fas fa-${game.twoWinsRule && game.players.length >= game.teamSize * 4 ? 'check' : 'times'} text-${game.twoWinsRule && game.players.length >= game.teamSize * 4 ? 'green' : 'gray'}-400 text-2xl"></i>
                                    <div class="text-gray-300 text-xs">Ganhou 2 Sai${game.twoWinsRule && game.players.length < game.teamSize * 4 ? ' (Inativa)' : ''}</div>
                                </div>
                            </div>
                            ${game.twoWinsRule && game.players.length < game.teamSize * 4 ? `
                                <div class="mt-3 text-center text-yellow-400 text-xs">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Regra "Ganhou 2 Sai" requer ${game.teamSize * 4} jogadores (4 times)
                                </div>
                            ` : ''}
                        </div>

                        <!-- Status -->
                        <div class="glass-card rounded-xl p-5">
                            <h3 class="text-white font-bold text-lg mb-3">Status</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-3xl font-bold gradient-orange bg-clip-text text-transparent">
                                        ${game.players.length}
                                    </div>
                                    <div class="text-gray-400 text-sm">Confirmados</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold gradient-yellow bg-clip-text text-transparent">
                                        ${game.maxPlayers - game.players.length}
                                    </div>
                                    <div class="text-gray-400 text-sm">Vagas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Jogadores Confirmados -->
                        <div class="glass-card rounded-xl p-5">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-white font-bold text-lg">
                                    <i class="fas fa-users mr-2 text-orange-400"></i>
                                    Jogadores (${players.length})
                                </h3>
                                ${isAdmin && game.status === 'open' ? `
                                    <button onclick="showAddVisitorModal(${game.id})"
                                        class="btn-primary px-4 py-2 rounded-lg text-white text-sm font-bold">
                                        <i class="fas fa-user-plus mr-1"></i>Visitante
                                    </button>
                                ` : ''}
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto hide-scrollbar">
                                ${players.map(player => `
                                    <div class="flex items-center justify-between bg-gray-700/50 rounded-lg p-3">
                                        <div class="flex items-center space-x-3">
                                            <div class="text-2xl">${player.photo}</div>
                                            <div>
                                                <div class="text-white font-medium">
                                                    ${player.name}
                                                    ${player.role === 'visitor' ? '<span class="text-xs text-yellow-400 ml-2">(Visitante)</span>' : ''}
                                                </div>
                                                <div class="text-gray-400 text-sm">
                                                    ${player.stats.wins}V / ${player.stats.losses}D
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="level-badge level-${player.level}">
                                                ${player.level}
                                            </div>
                                            ${isAdmin && game.status === 'open' ? `
                                                <button onclick="handleRemovePlayer(${game.id}, ${player.id})"
                                                    class="text-red-400 hover:text-red-300 p-2">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- A√ß√µes Admin -->
                        ${isAdmin && game.status === 'open' && players.length >= (game.teamSize * 2) ? `
                            <button onclick="handleCreateTeams(${game.id})"
                                class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg">
                                <i class="fas fa-users-cog mr-2"></i>CRIAR TIMES E INICIAR
                            </button>
                        ` : ''}

                        ${isAdmin && game.status === 'open' && players.length < (game.teamSize * 2) ? `
                            <div class="bg-yellow-500/20 border border-yellow-500 rounded-xl p-4 text-center">
                                <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                                <span class="text-yellow-300">M√≠nimo de ${game.teamSize * 2} jogadores para criar times (${game.teamSize} por time)</span>
                            </div>
                        ` : ''}

                        ${game.status === 'in_progress' ? `
                            <button onclick="navigateTo('play')"
                                class="bg-green-500 hover:bg-green-600 w-full py-4 rounded-xl text-white font-bold text-lg animate-pulse">
                                <i class="fas fa-play-circle mr-2"></i>IR PARA O JOGO
                            </button>
                        ` : ''}
                    </div>

                    ${BottomNav('games')}
                </div>
            `;
        }

        // Tela de Times (redireciona para Play se houver times)
        function TeamsScreen() {
            if (AppState.teams.length > 0) {
                navigateTo('play');
                return '';
            }

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <div class="gradient-orange p-6">
                        <h1 class="title-font text-3xl text-white mb-2">TIMES</h1>
                        <p class="text-orange-100">Gerencie os times do jogo</p>
                    </div>

                    <div class="p-6">
                        <div class="glass-card rounded-xl p-8 text-center">
                            <div class="text-6xl mb-4">üë•</div>
                            <h3 class="text-white text-xl font-bold mb-2">Nenhum Time Criado</h3>
                            <p class="text-gray-400 mb-6">Crie times a partir de um jogo com jogadores confirmados</p>
                            <button onclick="navigateTo('games')"
                                class="btn-primary px-6 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-calendar mr-2"></i>Ver Jogos
                            </button>
                        </div>
                    </div>

                    ${BottomNav('games')}
                </div>
            `;
        }

        // Tela Play (Gerenciamento do Jogo)
        function PlayScreen() {
            // Se n√£o tem times criados E n√£o tem jogo ativo
            if (AppState.teams.length === 0 && !AppState.activeMatch) {
                return `
                    <div class="min-h-screen pb-20 animate-fadeIn">
                        <div class="gradient-orange p-6">
                            <h1 class="title-font text-3xl text-white mb-2">JOGO</h1>
                            <p class="text-orange-100">Gerencie o jogo em andamento</p>
                        </div>

                        <div class="p-6">
                            <div class="glass-card rounded-xl p-8 text-center">
                                <div class="text-6xl mb-4">üèê</div>
                                <h3 class="text-white text-xl font-bold mb-2">Nenhum Jogo em Andamento</h3>
                                <p class="text-gray-400 mb-6">Crie times para come√ßar um jogo</p>
                                <button onclick="navigateTo('dashboard')"
                                    class="btn-primary px-6 py-3 rounded-lg text-white font-bold">
                                    <i class="fas fa-home mr-2"></i>Ir para Jogos
                                </button>
                            </div>
                        </div>

                        ${BottomNav('play')}
                    </div>
                `;
            }

            // Se tem times OU tem jogo ativo, mostra a tela com times
            return TeamsWithMatchScreen();
        }

        // Tela de Times com Controle de Partida
        function TeamsWithMatchScreen() {
            const match = AppState.activeMatch;
            const isAdmin = AppState.currentUser?.role === 'admin';

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <div class="gradient-orange p-6">
                        <h1 class="title-font text-3xl text-white mb-2">
                            <i class="fas fa-play-circle mr-2"></i>JOGO EM ANDAMENTO
                        </h1>
                        <p class="text-orange-100">Times e Placar</p>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Placar Atual -->
                        ${match ? `
                            <div class="glass-card rounded-xl p-6">
                                <h3 class="text-white font-bold text-lg mb-4 text-center">
                                    <i class="fas fa-trophy mr-2 text-yellow-400"></i>
                                    Partida Atual
                                </h3>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="text-center">
                                        <div class="inline-block px-4 py-2 rounded-full text-white font-bold mb-2"
                                            style="background: ${match.team1.color}">
                                            ${match.team1.name}
                                        </div>
                                        <div class="text-5xl font-bold text-white">${match.score1}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="inline-block px-4 py-2 rounded-full text-white font-bold mb-2"
                                            style="background: ${match.team2.color}">
                                            ${match.team2.name}
                                        </div>
                                        <div class="text-5xl font-bold text-white">${match.score2}</div>
                                    </div>
                                </div>
                                ${isAdmin ? `
                                    <button onclick="navigateTo('match')"
                                        class="btn-secondary w-full py-3 rounded-lg text-white font-bold">
                                        <i class="fas fa-edit mr-2"></i>CONTROLAR PLACAR
                                    </button>
                                ` : ''}
                            </div>
                        ` : ''}

                        <!-- Times -->
                        ${AppState.teams.map((team, index) => `
                            <div class="glass-card rounded-xl overflow-hidden shadow-lg animate-fadeIn"
                                style="animation-delay: ${index * 0.1}s">
                                <div class="p-4" style="background: linear-gradient(135deg, ${team.color}dd 0%, ${team.color}99 100%)">
                                    <h3 class="text-white font-bold text-xl">
                                        <i class="fas fa-shield-alt mr-2"></i>
                                        Time ${team.name}
                                    </h3>
                                    <p class="text-white/80 text-sm">
                                        N√≠vel m√©dio: ${(team.players.reduce((sum, p) => sum + p.level, 0) / team.players.length).toFixed(1)}
                                    </p>
                                </div>
                                <div class="p-4 space-y-3">
                                    ${team.players.map(player => `
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <div class="text-2xl">${player.photo}</div>
                                                <div>
                                                    <div class="text-white font-medium">${player.name}</div>
                                                    <div class="text-gray-400 text-sm">
                                                        ${player.stats.wins}V / ${player.stats.losses}D
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="level-badge level-${player.level}">
                                                ${player.level}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}

                        <!-- Hist√≥rico de Partidas -->
                        ${AppState.matchHistory.length > 0 ? `
                            <div class="glass-card rounded-xl p-5">
                                <h3 class="text-white font-bold text-lg mb-4">
                                    <i class="fas fa-history mr-2 text-yellow-400"></i>
                                    Hist√≥rico (${AppState.matchHistory.length} partida${AppState.matchHistory.length > 1 ? 's' : ''})
                                </h3>
                                <div class="space-y-3 max-h-96 overflow-y-auto hide-scrollbar">
                                    ${AppState.matchHistory.slice().reverse().map((m, index) => `
                                        <div class="bg-gray-700/50 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-gray-400 text-sm">Partida #${m.matchNumber}</span>
                                                <span class="text-yellow-400 text-xs">
                                                    <i class="fas fa-trophy mr-1"></i>${m.winner}
                                                </span>
                                            </div>
                                            <div class="grid grid-cols-3 gap-2 items-center">
                                                <div class="text-right">
                                                    <div class="text-white font-bold">${m.team1.name}</div>
                                                    <div class="text-2xl font-bold ${m.score1 > m.score2 ? 'text-green-400' : 'text-gray-500'}">
                                                        ${m.score1}
                                                    </div>
                                                </div>
                                                <div class="text-center text-gray-500 font-bold">X</div>
                                                <div class="text-left">
                                                    <div class="text-white font-bold">${m.team2.name}</div>
                                                    <div class="text-2xl font-bold ${m.score2 > m.score1 ? 'text-green-400' : 'text-gray-500'}">
                                                        ${m.score2}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Estat√≠sticas por Time -->
                            <div class="glass-card rounded-xl p-5">
                                <h3 class="text-white font-bold text-lg mb-4">
                                    <i class="fas fa-chart-bar mr-2 text-orange-400"></i>
                                    Placar Geral
                                </h3>
                                <div class="space-y-3">
                                    ${(() => {
                                        const teamWins = {};
                                        AppState.matchHistory.forEach(match => {
                                            teamWins[match.winner] = (teamWins[match.winner] || 0) + 1;
                                        });

                                        return AppState.teams.map(team => {
                                            const wins = teamWins[team.name] || 0;
                                            return `
                                                <div class="flex items-center justify-between bg-gray-700/50 rounded-lg p-3">
                                                    <div class="flex items-center space-x-3">
                                                        <div class="w-4 h-4 rounded-full" style="background: ${team.color}"></div>
                                                        <span class="text-white font-bold">${team.name}</span>
                                                    </div>
                                                    <div class="text-2xl font-bold text-green-400">${wins}</div>
                                                </div>
                                            `;
                                        }).join('');
                                    })()}
                                </div>
                            </div>
                        ` : ''}

                        <!-- A√ß√µes -->
                        ${isAdmin ? `
                            ${!match ? `
                                <button onclick="handleStartMatch()"
                                    class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg animate-pulse">
                                    <i class="fas fa-play-circle mr-2"></i>${AppState.matchHistory.length === 0 ? 'INICIAR PRIMEIRA PARTIDA' : 'INICIAR PR√ìXIMA PARTIDA'}
                                </button>
                            ` : ''}
                            <button onclick="finishGame()"
                                class="bg-red-500 hover:bg-red-600 w-full py-4 rounded-xl text-white font-bold text-lg">
                                <i class="fas fa-flag-checkered mr-2"></i>FINALIZAR JOGO
                            </button>
                        ` : ''}
                    </div>

                    ${BottomNav('play')}
                </div>
            `;
        }

        // Tela de Placar
        function MatchScreen() {
            const match = AppState.activeMatch;

            if (!match) {
                navigateTo('play');
                return '';
            }

            return `
                <div class="min-h-screen pb-20 bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 animate-fadeIn">
                    <!-- Header -->
                    <div class="gradient-blue p-4">
                        <button onclick="navigateTo('play')"
                            class="text-white hover:bg-white/20 px-3 py-2 rounded-lg transition">
                            <i class="fas fa-arrow-left mr-2"></i>Voltar ao Jogo
                        </button>
                    </div>

                    <div class="p-6">
                        <!-- Placar Principal -->
                        <div class="glass-card rounded-2xl p-6 mb-6">
                            <div class="text-center mb-6">
                                <h2 class="text-white/60 text-sm uppercase tracking-wider mb-2">Partida em Andamento</h2>
                                <div class="text-orange-400 font-bold">
                                    At√© ${match.maxPoints} pontos
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <!-- Time 1 -->
                                <div class="text-center">
                                    <div class="mb-3">
                                        <div class="inline-block px-4 py-2 rounded-full text-white font-bold mb-2"
                                            style="background: ${match.team1.color}">
                                            ${match.team1.name}
                                        </div>
                                    </div>
                                    <div class="score-display text-white mb-4">
                                        ${match.score1}
                                    </div>
                                    ${AppState.currentUser?.role === 'admin' && !match.finished ? `
                                        <div class="flex gap-2 justify-center">
                                            <button onclick="updateScore(1, -1)"
                                                class="bg-red-500 hover:bg-red-600 w-12 h-12 rounded-full text-white font-bold text-xl">
                                                -
                                            </button>
                                            <button onclick="updateScore(1, 1)"
                                                class="bg-green-500 hover:bg-green-600 w-12 h-12 rounded-full text-white font-bold text-xl">
                                                +
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- Time 2 -->
                                <div class="text-center">
                                    <div class="mb-3">
                                        <div class="inline-block px-4 py-2 rounded-full text-white font-bold mb-2"
                                            style="background: ${match.team2.color}">
                                            ${match.team2.name}
                                        </div>
                                    </div>
                                    <div class="score-display text-white mb-4">
                                        ${match.score2}
                                    </div>
                                    ${AppState.currentUser?.role === 'admin' && !match.finished ? `
                                        <div class="flex gap-2 justify-center">
                                            <button onclick="updateScore(2, -1)"
                                                class="bg-red-500 hover:bg-red-600 w-12 h-12 rounded-full text-white font-bold text-xl">
                                                -
                                            </button>
                                            <button onclick="updateScore(2, 1)"
                                                class="bg-green-500 hover:bg-green-600 w-12 h-12 rounded-full text-white font-bold text-xl">
                                                +
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            ${match.finished ? `
                                <div class="text-center py-6">
                                    <div class="text-4xl mb-3">üèÜ</div>
                                    <div class="text-yellow-400 font-bold text-2xl mb-2">
                                        Time ${match.score1 > match.score2 ? match.team1.name : match.team2.name} Venceu!
                                    </div>
                                    <button onclick="resetMatch()"
                                        class="btn-primary mt-4 px-6 py-3 rounded-lg text-white font-bold">
                                        <i class="fas fa-redo mr-2"></i>Nova Partida
                                    </button>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Jogadores dos Times -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${[match.team1, match.team2].map(team => `
                                <div class="glass-card rounded-xl p-4">
                                    <h3 class="text-white font-bold mb-3 flex items-center">
                                        <div class="w-3 h-3 rounded-full mr-2" style="background: ${team.color}"></div>
                                        ${team.name}
                                    </h3>
                                    <div class="space-y-2">
                                        ${team.players.map(p => `
                                            <div class="flex items-center space-x-2 text-sm">
                                                <div>${p.photo}</div>
                                                <div class="text-white">${p.name}</div>
                                                <div class="level-badge level-${p.level} !w-6 !h-6 !text-xs ml-auto">
                                                    ${p.level}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Tela de Estat√≠sticas
        function StatsScreen() {
            const user = AppState.currentUser;
            const totalGames = user.stats.wins + user.stats.losses;
            const winRate = totalGames > 0 ? ((user.stats.wins / totalGames) * 100).toFixed(1) : 0;

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <div class="gradient-yellow p-6">
                        <h1 class="title-font text-3xl text-white mb-2">ESTAT√çSTICAS</h1>
                        <p class="text-yellow-100">Seu desempenho em detalhes</p>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Card Principal -->
                        <div class="glass-card rounded-xl p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center space-x-4">
                                    <div class="text-5xl">${user.photo}</div>
                                    <div>
                                        <h2 class="text-white font-bold text-2xl">${user.name}</h2>
                                        <p class="text-gray-400">Jogador desde 2024</p>
                                    </div>
                                </div>
                                <div class="level-badge level-${user.level} !w-16 !h-16 !text-2xl">
                                    ${user.level}
                                </div>
                            </div>

                            <!-- Estat√≠sticas Grid -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-green-500/20 border border-green-500 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-green-400">${user.stats.wins}</div>
                                    <div class="text-gray-300 text-sm">Vit√≥rias</div>
                                </div>
                                <div class="bg-red-500/20 border border-red-500 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-red-400">${user.stats.losses}</div>
                                    <div class="text-gray-300 text-sm">Derrotas</div>
                                </div>
                                <div class="bg-yellow-500/20 border border-yellow-500 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-yellow-400">${winRate}%</div>
                                    <div class="text-gray-300 text-sm">Taxa de Vit√≥ria</div>
                                </div>
                                <div class="bg-orange-500/20 border border-orange-500 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-orange-400">${user.stats.championships}</div>
                                    <div class="text-gray-300 text-sm">T√≠tulos</div>
                                </div>
                            </div>
                        </div>

                        <!-- Evolu√ß√£o de N√≠vel -->
                        <div class="glass-card rounded-xl p-6">
                            <h3 class="text-white font-bold text-lg mb-4">
                                <i class="fas fa-chart-line mr-2 text-orange-400"></i>
                                Evolu√ß√£o de N√≠vel
                            </h3>
                            <div class="space-y-3">
                                ${[6, 5, 4, 3, 2, 1].map(level => `
                                    <div class="flex items-center space-x-3">
                                        <div class="level-badge level-${level} !w-8 !h-8 !text-sm">${level}</div>
                                        <div class="flex-1">
                                            <div class="bg-gray-700 rounded-full h-3 overflow-hidden">
                                                <div class="h-full level-${level} transition-all duration-1000"
                                                    style="width: ${user.level >= level ? '100%' : '0%'}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-white text-sm font-medium w-16 text-right">
                                            ${user.level === level ? 'Atual' : user.level > level ? 'Conclu√≠do' : 'Bloqueado'}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Ranking Global (Mock) -->
                        <div class="glass-card rounded-xl p-6">
                            <h3 class="text-white font-bold text-lg mb-4">
                                <i class="fas fa-trophy mr-2 text-yellow-400"></i>
                                Ranking Global
                            </h3>
                            <div class="space-y-3">
                                ${AppState.users
                                    .sort((a, b) => b.stats.wins - a.stats.wins)
                                    .slice(0, 5)
                                    .map((u, index) => `
                                        <div class="flex items-center space-x-3 ${u.id === user.id ? 'bg-orange-500/20 border border-orange-500 rounded-lg p-2' : ''}">
                                            <div class="text-2xl font-bold ${index === 0 ? 'text-yellow-400' : index === 1 ? 'text-gray-300' : index === 2 ? 'text-orange-600' : 'text-gray-500'} w-8">
                                                #${index + 1}
                                            </div>
                                            <div class="text-xl">${u.photo}</div>
                                            <div class="flex-1">
                                                <div class="text-white font-medium">${u.name}</div>
                                                <div class="text-gray-400 text-sm">${u.stats.wins} vit√≥rias</div>
                                            </div>
                                            <div class="level-badge level-${u.level}">${u.level}</div>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                    </div>

                    ${BottomNav('stats')}
                </div>
            `;
        }

        // Tela de Gerenciamento de Usu√°rios (Admin apenas)
        function UsersScreen() {
            if (AppState.currentUser?.role !== 'admin') {
                navigateTo('dashboard');
                return '';
            }

            const allUsers = AppState.users.sort((a, b) => {
                // Admins primeiro
                if (a.role === 'admin' && b.role !== 'admin') return -1;
                if (a.role !== 'admin' && b.role === 'admin') return 1;
                // Depois por n√≠vel
                return b.level - a.level;
            });

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <div class="gradient-orange p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="title-font text-3xl text-white mb-2">USU√ÅRIOS</h1>
                                <p class="text-orange-100">Gerenciar jogadores da plataforma</p>
                            </div>
                            <button onclick="navigateTo('dashboard')"
                                class="text-white hover:bg-white/20 p-2 rounded-lg transition">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 space-y-4">
                        <!-- Info -->
                        <div class="glass-card rounded-xl p-4">
                            <div class="flex items-center justify-between text-sm">
                                <div class="text-gray-300">
                                    <i class="fas fa-users mr-2 text-orange-400"></i>
                                    Total de usu√°rios: <span class="text-white font-bold">${allUsers.length}</span>
                                </div>
                                <div class="text-gray-300">
                                    <i class="fas fa-user-shield mr-2 text-yellow-400"></i>
                                    Admins: <span class="text-white font-bold">${allUsers.filter(u => u.role === 'admin').length}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Usu√°rios -->
                        ${allUsers.map(user => `
                            <div class="glass-card rounded-xl p-4 ${user.role === 'admin' ? 'border-2 border-yellow-500/50' : ''}">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center space-x-3 flex-1">
                                        <div class="text-3xl">${user.photo}</div>
                                        <div class="flex-1">
                                            <div class="text-white font-bold text-lg">${user.name}</div>
                                            <div class="text-gray-400 text-sm">${user.email}</div>
                                            <div class="flex items-center gap-2 mt-1">
                                                ${user.role === 'admin' ? `
                                                    <span class="bg-yellow-500/20 border border-yellow-500 text-yellow-400 text-xs px-2 py-1 rounded-full">
                                                        <i class="fas fa-crown mr-1"></i>Admin
                                                    </span>
                                                ` : `
                                                    <span class="bg-blue-500/20 border border-blue-500 text-blue-400 text-xs px-2 py-1 rounded-full">
                                                        <i class="fas fa-user mr-1"></i>Jogador
                                                    </span>
                                                `}
                                                ${user.role === 'visitor' ? `
                                                    <span class="bg-purple-500/20 border border-purple-500 text-purple-400 text-xs px-2 py-1 rounded-full">
                                                        <i class="fas fa-user-clock mr-1"></i>Visitante
                                                    </span>
                                                ` : ''}
                                                <span class="${user.paymentType === 'monthly' ? 'bg-green-500/20 border border-green-500 text-green-400' : 'bg-cyan-500/20 border border-cyan-500 text-cyan-400'} text-xs px-2 py-1 rounded-full">
                                                    <i class="fas ${user.paymentType === 'monthly' ? 'fa-calendar-alt' : 'fa-ticket-alt'} mr-1"></i>${user.paymentType === 'monthly' ? 'Mensalista' : 'Diarista'}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="level-badge level-${user.level} ml-2">
                                        ${user.level}
                                    </div>
                                </div>

                                <!-- Stats -->
                                <div class="grid grid-cols-3 gap-2 mb-3 text-center text-sm">
                                    <div class="bg-gray-700/50 rounded-lg p-2">
                                        <div class="text-green-400 font-bold">${user.stats.wins}</div>
                                        <div class="text-gray-400 text-xs">Vit√≥rias</div>
                                    </div>
                                    <div class="bg-gray-700/50 rounded-lg p-2">
                                        <div class="text-red-400 font-bold">${user.stats.losses}</div>
                                        <div class="text-gray-400 text-xs">Derrotas</div>
                                    </div>
                                    <div class="bg-gray-700/50 rounded-lg p-2">
                                        <div class="text-yellow-400 font-bold">${user.stats.championships}</div>
                                        <div class="text-gray-400 text-xs">T√≠tulos</div>
                                    </div>
                                </div>

                                <!-- Bot√µes de A√ß√£o -->
                                ${user.id !== AppState.currentUser.id ? `
                                    <div class="space-y-2">
                                        <div class="flex gap-2">
                                            <button onclick="showEditUserModal(${user.id})"
                                                class="btn-secondary flex-1 py-2 rounded-lg text-white text-sm font-bold">
                                                <i class="fas fa-edit mr-1"></i>N√≠vel
                                            </button>
                                            <button onclick="toggleUserRole(${user.id})"
                                                class="btn-primary flex-1 py-2 rounded-lg text-white text-sm font-bold">
                                                <i class="fas fa-exchange-alt mr-1"></i>Perfil
                                            </button>
                                        </div>
                                        <button onclick="togglePaymentType(${user.id})"
                                            class="w-full py-2 rounded-lg text-white text-sm font-bold ${user.paymentType === 'monthly' ? 'bg-green-600 hover:bg-green-700' : 'bg-cyan-600 hover:bg-cyan-700'}">
                                            <i class="fas fa-wallet mr-1"></i>Trocar para ${user.paymentType === 'monthly' ? 'Diarista' : 'Mensalista'}
                                        </button>
                                    </div>
                                ` : `
                                    <div class="space-y-2">
                                        <div class="text-center text-gray-500 text-sm py-2 mb-2">
                                            <i class="fas fa-lock mr-1"></i>Voc√™ n√£o pode editar n√≠vel e perfil pr√≥prios
                                        </div>
                                        <button onclick="togglePaymentType(${user.id})"
                                            class="w-full py-2 rounded-lg text-white text-sm font-bold ${user.paymentType === 'monthly' ? 'bg-green-600 hover:bg-green-700' : 'bg-cyan-600 hover:bg-cyan-700'}">
                                            <i class="fas fa-wallet mr-1"></i>Trocar para ${user.paymentType === 'monthly' ? 'Diarista' : 'Mensalista'}
                                        </button>
                                    </div>
                                `}
                            </div>
                        `).join('')}
                    </div>

                    ${BottomNav('dashboard')}
                </div>
            `;
        }

        // Tela de Controle de Mensalidades (Admin apenas)
        function PaymentsScreen() {
            if (AppState.currentUser?.role !== 'admin') {
                navigateTo('dashboard');
                return '';
            }

            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const monthlyUsers = AppState.users.filter(u => u.paymentType === 'monthly');

            const currentFee = AppState.monthlyFees[currentMonth] || 0;
            const perPersonFee = monthlyUsers.length > 0 ? currentFee / monthlyUsers.length : 0;

            // Calcular quantos j√° pagaram
            const paidCount = monthlyUsers.filter(u => u.monthlyPayments[currentMonth]?.paid).length;
            const pendingCount = monthlyUsers.length - paidCount;

            return `
                <div class="min-h-screen pb-20 animate-fadeIn">
                    <div class="gradient-orange p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="title-font text-3xl text-white mb-2">MENSALIDADES</h1>
                                <p class="text-orange-100">Controle de pagamentos mensais</p>
                            </div>
                            <button onclick="navigateTo('dashboard')"
                                class="text-white hover:bg-white/20 p-2 rounded-lg transition">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Configura√ß√£o do Valor -->
                        <div class="glass-card rounded-xl p-5">
                            <h3 class="text-white font-bold text-lg mb-4">
                                <i class="fas fa-cog mr-2 text-orange-400"></i>
                                Configura√ß√£o - ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-white font-medium mb-2">
                                        Valor Total da Mensalidade
                                    </label>
                                    <div class="flex gap-3">
                                        <div class="relative flex-1">
                                            <span class="absolute left-4 top-3 text-gray-400">R$</span>
                                            <input type="number" id="monthly-fee-value"
                                                value="${currentFee}"
                                                min="0"
                                                step="0.01"
                                                class="custom-input w-full pl-12 pr-4 py-3 rounded-lg text-white"
                                                placeholder="0.00">
                                        </div>
                                        <button onclick="saveMouthlyFee()"
                                            class="btn-primary px-6 py-3 rounded-lg text-white font-bold">
                                            <i class="fas fa-save mr-2"></i>Salvar
                                        </button>
                                    </div>
                                </div>

                                <!-- Info Cards -->
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="bg-green-500/20 border border-green-500 rounded-lg p-3 text-center">
                                        <div class="text-2xl font-bold text-green-400">${monthlyUsers.length}</div>
                                        <div class="text-gray-300 text-xs">Mensalistas</div>
                                    </div>
                                    <div class="bg-orange-500/20 border border-orange-500 rounded-lg p-3 text-center">
                                        <div class="text-lg font-bold text-orange-400">R$ ${perPersonFee.toFixed(2)}</div>
                                        <div class="text-gray-300 text-xs">Por Pessoa</div>
                                    </div>
                                    <div class="bg-blue-500/20 border border-blue-500 rounded-lg p-3 text-center">
                                        <div class="text-2xl font-bold text-blue-400">${paidCount}/${monthlyUsers.length}</div>
                                        <div class="text-gray-300 text-xs">Pagaram</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Mensalistas -->
                        ${monthlyUsers.length > 0 ? `
                            <div class="glass-card rounded-xl p-5">
                                <h3 class="text-white font-bold text-lg mb-4">
                                    <i class="fas fa-users mr-2 text-green-400"></i>
                                    Mensalistas (${monthlyUsers.length})
                                </h3>
                                <div class="space-y-3">
                                    ${monthlyUsers.map(user => {
                                        const hasPaid = user.monthlyPayments[currentMonth]?.paid || false;
                                        return `
                                            <div class="bg-gray-700/50 rounded-lg p-4 ${hasPaid ? 'border-2 border-green-500' : 'border-2 border-gray-600'}">
                                                <div class="flex items-center justify-between mb-3">
                                                    <div class="flex items-center space-x-3 flex-1">
                                                        <div class="text-2xl">${user.photo}</div>
                                                        <div class="flex-1">
                                                            <div class="text-white font-bold">${user.name}</div>
                                                            <div class="text-gray-400 text-sm">${user.email}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <div class="text-xl font-bold ${hasPaid ? 'text-green-400' : 'text-orange-400'}">
                                                            R$ ${perPersonFee.toFixed(2)}
                                                        </div>
                                                        <div class="text-xs ${hasPaid ? 'text-green-400' : 'text-gray-400'}">
                                                            ${hasPaid ? 'PAGO ‚úì' : 'PENDENTE'}
                                                        </div>
                                                    </div>
                                                </div>
                                                <button onclick="togglePaymentStatus(${user.id}, '${currentMonth}')"
                                                    class="w-full py-2 rounded-lg text-white font-bold ${hasPaid ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'}">
                                                    <i class="fas ${hasPaid ? 'fa-times' : 'fa-check'} mr-2"></i>
                                                    ${hasPaid ? 'Marcar como Pendente' : 'Marcar como Pago'}
                                                </button>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        ` : `
                            <div class="glass-card rounded-xl p-8 text-center">
                                <div class="text-6xl mb-4">üí∞</div>
                                <h3 class="text-white text-xl font-bold mb-2">Nenhum Mensalista</h3>
                                <p class="text-gray-400 mb-6">N√£o h√° usu√°rios cadastrados como mensalistas</p>
                                <button onclick="navigateTo('users')"
                                    class="btn-primary px-6 py-3 rounded-lg text-white font-bold">
                                    <i class="fas fa-users mr-2"></i>Gerenciar Usu√°rios
                                </button>
                            </div>
                        `}

                        ${pendingCount > 0 ? `
                            <div class="bg-yellow-500/20 border border-yellow-500 rounded-xl p-4">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-exclamation-triangle text-yellow-400 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <div class="text-yellow-300 font-bold mb-1">Aten√ß√£o!</div>
                                        <div class="text-yellow-100 text-sm">
                                            ${pendingCount} ${pendingCount === 1 ? 'mensalista ainda n√£o pagou' : 'mensalistas ainda n√£o pagaram'} este m√™s.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : monthlyUsers.length > 0 ? `
                            <div class="bg-green-500/20 border border-green-500 rounded-xl p-4">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-check-circle text-green-400 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <div class="text-green-300 font-bold mb-1">Tudo Certo!</div>
                                        <div class="text-green-100 text-sm">
                                            Todos os mensalistas j√° pagaram este m√™s! üéâ
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    ${BottomNav('dashboard')}
                </div>
            `;
        }

        // Navega√ß√£o Inferior
        function BottomNav(active) {
            const hasActiveMatch = AppState.activeMatch !== null;

            const items = [
                { id: 'dashboard', icon: 'fa-home', label: 'In√≠cio' },
                { id: 'games', icon: 'fa-calendar', label: 'Jogos' },
                { id: 'play', icon: 'fa-play-circle', label: 'Play', highlight: hasActiveMatch },
                { id: 'stats', icon: 'fa-chart-bar', label: 'Stats' }
            ];

            return `
                <div class="fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-lg border-t border-gray-700 shadow-2xl">
                    <div class="grid grid-cols-4 gap-1 p-2">
                        ${items.map(item => `
                            <button onclick="navigateTo('${item.id}')"
                                class="relative flex flex-col items-center justify-center py-3 rounded-lg transition ${active === item.id ? 'bg-orange-500 text-white' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}">
                                ${item.highlight ? '<div class="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>' : ''}
                                <i class="fas ${item.icon} text-xl mb-1 ${item.highlight ? 'animate-pulse' : ''}"></i>
                                <span class="text-xs font-medium">${item.label}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ============================================
        // HANDLERS DE EVENTOS
        // ============================================
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (login(email, password)) {
                showNotification('Login realizado com sucesso! üéâ', 'success');
            } else {
                showNotification('Email ou senha incorretos', 'error');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const paymentType = document.querySelector('input[name="payment-type"]:checked').value;

            register(name, email, password, paymentType);
            showNotification('Conta criada com sucesso! üéâ', 'success');
        }

        function handleJoinGame(gameId) {
            if (joinGame(gameId)) {
                showNotification('Voc√™ entrou no jogo! üèê', 'success');
                render();
            } else {
                showNotification('N√£o foi poss√≠vel entrar no jogo', 'error');
            }
        }

        function handleLeaveGame(gameId) {
            if (leaveGame(gameId)) {
                showNotification('Voc√™ saiu do jogo', 'info');
                render();
            }
        }

        function handleCreateTeams(gameId) {
            const game = AppState.games.find(g => g.id === gameId);
            if (game) {
                createBalancedTeams(game.players, game.teamSize);
                game.status = 'in_progress';
                AppState.currentGame = game;
                saveState();
                showNotification('Jogo iniciado! Times criados com sucesso! üéØ', 'success');
                navigateTo('play');
            }
        }

        function handleStartMatch() {
            const nextMatch = getNextMatch();
            if (!nextMatch) {
                showNotification('Erro ao criar pr√≥xima partida', 'error');
                return;
            }

            AppState.activeMatch = {
                ...nextMatch,
                score1: 0,
                score2: 0,
                maxPoints: AppState.currentGame.pointsPerMatch,
                finished: false,
                gameId: AppState.currentGame.id,
                matchNumber: AppState.matchHistory.length + 1
            };
            saveState();
            navigateTo('match');
            showNotification('Partida iniciada! Boa sorte! üèê', 'success');
        }

        // Determina qual ser√° a pr√≥xima partida baseado no hist√≥rico e regras
        function getNextMatch() {
            const numTeams = AppState.teams.length;
            const history = AppState.matchHistory;
            const game = AppState.currentGame;

            // Se n√£o tem hist√≥rico, primeiro jogo √© Time 1 vs Time 2
            if (history.length === 0) {
                return {
                    team1: AppState.teams[0],
                    team2: AppState.teams[1],
                    team1Index: 0,
                    team2Index: 1
                };
            }

            const lastMatch = history[history.length - 1];
            const winnerIndex = lastMatch.score1 > lastMatch.score2 ? lastMatch.team1Index : lastMatch.team2Index;
            const loserIndex = lastMatch.score1 > lastMatch.score2 ? lastMatch.team2Index : lastMatch.team1Index;

            // 2 TIMES: sempre os mesmos jogam
            if (numTeams === 2) {
                return {
                    team1: AppState.teams[0],
                    team2: AppState.teams[1],
                    team1Index: 0,
                    team2Index: 1
                };
            }

            // 3 TIMES: quem ganha permanece, entra o pr√≥ximo na fila
            if (numTeams === 3) {
                const nextOpponentIndex = [0, 1, 2].find(i => i !== winnerIndex && i !== loserIndex);
                return {
                    team1: AppState.teams[winnerIndex],
                    team2: AppState.teams[nextOpponentIndex],
                    team1Index: winnerIndex,
                    team2Index: nextOpponentIndex
                };
            }

            // 4 TIMES: regra "ganhou 2 sai" se ativa, sen√£o quem ganha permanece
            if (numTeams === 4) {
                // Verificar se o time vencedor ganhou as √∫ltimas 2
                const consecutiveWins = game.twoWinsRule && checkConsecutiveWins(winnerIndex, 2);

                if (consecutiveWins) {
                    // Time ganhou 2 seguidas, sai e os dois de fora entram
                    const outTeams = [0, 1, 2, 3].filter(i =>
                        i !== lastMatch.team1Index && i !== lastMatch.team2Index
                    );
                    return {
                        team1: AppState.teams[outTeams[0]],
                        team2: AppState.teams[outTeams[1]],
                        team1Index: outTeams[0],
                        team2Index: outTeams[1]
                    };
                } else {
                    // Vencedor permanece, perdedor sai e entra um dos que est√° de fora
                    const outTeams = [0, 1, 2, 3].filter(i =>
                        i !== lastMatch.team1Index && i !== lastMatch.team2Index
                    );
                    // Entra o primeiro time que est√° de fora
                    return {
                        team1: AppState.teams[winnerIndex],
                        team2: AppState.teams[outTeams[0]],
                        team1Index: winnerIndex,
                        team2Index: outTeams[0]
                    };
                }
            }

            return null;
        }

        // Verifica se um time ganhou N partidas consecutivas
        function checkConsecutiveWins(teamIndex, count) {
            const history = AppState.matchHistory;
            if (history.length < count) return false;

            for (let i = 0; i < count; i++) {
                const match = history[history.length - 1 - i];
                const winnerIdx = match.score1 > match.score2 ? match.team1Index : match.team2Index;
                if (winnerIdx !== teamIndex) return false;
            }
            return true;
        }

        function updateScore(team, delta) {
            const match = AppState.activeMatch;
            if (!match || match.finished) return;

            if (team === 1) {
                match.score1 = Math.max(0, match.score1 + delta);
            } else {
                match.score2 = Math.max(0, match.score2 + delta);
            }

            // Verificar vit√≥ria
            if (match.score1 >= match.maxPoints && match.score1 - match.score2 >= 2) {
                match.finished = true;
                finishMatch();
                showNotification(`Time ${match.team1.name} venceu! üèÜ`, 'success');
            } else if (match.score2 >= match.maxPoints && match.score2 - match.score1 >= 2) {
                match.finished = true;
                finishMatch();
                showNotification(`Time ${match.team2.name} venceu! üèÜ`, 'success');
            }

            saveState();
            render();
        }

        // Salva a partida no hist√≥rico
        function finishMatch() {
            const match = AppState.activeMatch;
            if (!match) return;

            // Adicionar ao hist√≥rico
            const matchRecord = {
                matchNumber: match.matchNumber,
                team1: match.team1,
                team2: match.team2,
                team1Index: match.team1Index,
                team2Index: match.team2Index,
                score1: match.score1,
                score2: match.score2,
                winner: match.score1 > match.score2 ? match.team1.name : match.team2.name,
                timestamp: new Date().toISOString()
            };

            AppState.matchHistory.push(matchRecord);

            // Adicionar ao hist√≥rico do jogo tamb√©m
            if (AppState.currentGame) {
                AppState.currentGame.matchHistory = AppState.matchHistory;

                // Atualizar o jogo na lista
                const gameIndex = AppState.games.findIndex(g => g.id === AppState.currentGame.id);
                if (gameIndex !== -1) {
                    AppState.games[gameIndex].matchHistory = AppState.matchHistory;
                }
            }

            saveState();
        }

        function resetMatch() {
            // Criar a pr√≥xima partida baseado no hist√≥rico
            handleStartMatch();
        }

        function finishGame() {
            const game = AppState.currentGame || AppState.games.find(g => g.id === AppState.activeMatch?.gameId);
            if (game) {
                game.status = 'finished';

                // Calcular vencedor baseado nas vit√≥rias totais
                const teamWins = {};
                AppState.matchHistory.forEach(match => {
                    const winner = match.winner;
                    teamWins[winner] = (teamWins[winner] || 0) + 1;
                });

                // Encontrar o time com mais vit√≥rias
                let maxWins = 0;
                let champion = '';
                Object.keys(teamWins).forEach(team => {
                    if (teamWins[team] > maxWins) {
                        maxWins = teamWins[team];
                        champion = team;
                    }
                });

                game.champion = champion || 'Nenhum vencedor';
                game.finalStats = teamWins;

                // Atualizar o jogo na lista
                const gameIndex = AppState.games.findIndex(g => g.id === game.id);
                if (gameIndex !== -1) {
                    AppState.games[gameIndex] = game;
                }
            }

            AppState.activeMatch = null;
            AppState.currentGame = null;
            AppState.teams = [];
            AppState.matchHistory = [];
            saveState();
            showNotification(`Jogo finalizado! üèÜ Campe√£o: ${game.champion}`, 'success');
            navigateTo('dashboard');
        }

        // ============================================
        // SISTEMA DE AJUDA
        // ============================================
        function showHelpModal() {
            const isAdmin = AppState.currentUser?.role === 'admin';

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn overflow-y-auto';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-2xl w-full my-8 max-h-[90vh] overflow-y-auto hide-scrollbar">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 gradient-orange rounded-full flex items-center justify-center">
                                <i class="fas fa-question text-white text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-white font-bold text-2xl">Centro de Ajuda</h2>
                                <p class="text-gray-400 text-sm">
                                    ${isAdmin ? 'üë®‚Äçüíº Modo Administrador' : 'üèê Modo Jogador'}
                                </p>
                            </div>
                        </div>
                        <button onclick="this.closest('.fixed').remove()"
                            class="text-gray-400 hover:text-white p-2">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>

                    ${isAdmin ? AdminHelp() : PlayerHelp()}

                    <!-- Bot√£o Fechar -->
                    <button onclick="this.closest('.fixed').remove()"
                        class="btn-primary w-full py-3 rounded-lg text-white font-bold mt-6">
                        <i class="fas fa-check mr-2"></i>ENTENDI
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function AdminHelp() {
            return `
                <div class="space-y-6">
                    <!-- Suas Permiss√µes -->
                    <div class="bg-green-500/10 border border-green-500 rounded-xl p-4">
                        <h3 class="text-green-400 font-bold text-lg mb-3">
                            <i class="fas fa-crown mr-2"></i>Suas Permiss√µes de Admin
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Criar e gerenciar jogos</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Adicionar visitantes sem cadastro</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Remover jogadores da lista</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Criar times balanceados automaticamente</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Controlar placar das partidas</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Finalizar jogos</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Gerenciar usu√°rios (editar n√≠vel, perfil e tipo de pagamento)</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-green-400 mt-1"></i>
                                <span>Controlar mensalidades dos mensalistas</span>
                            </div>
                        </div>
                    </div>

                    <!-- Guia R√°pido -->
                    <div>
                        <h3 class="text-white font-bold text-lg mb-3">
                            <i class="fas fa-book mr-2 text-orange-400"></i>
                            Guia R√°pido
                        </h3>

                        <!-- Criar Jogo -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">1Ô∏è‚É£ Criar um Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Na aba <strong>In√≠cio</strong>, clique em "CRIAR NOVO JOGO"
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üìÖ Defina a data<br>
                                üë• Escolha max. de jogadores (8-32)<br>
                                üèê Selecione tamanho do time (4 ou 6)<br>
                                üèÜ Ative/desative regra "Ganhou 2 Sai"
                            </div>
                        </div>

                        <!-- Gerenciar Participantes -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">2Ô∏è‚É£ Gerenciar Participantes</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Clique no √≠cone üëÅÔ∏è do jogo para ver detalhes
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                ‚ûï <strong>Adicionar Visitante:</strong> Clique em "Visitante" e informe nome e n√≠vel<br>
                                ‚ùå <strong>Remover Jogador:</strong> Clique no X ao lado do nome<br>
                                ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> S√≥ funciona antes de iniciar o jogo!
                            </div>
                        </div>

                        <!-- Iniciar Jogo -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">3Ô∏è‚É£ Iniciar o Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Com m√≠nimo 8 jogadores confirmados
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üéØ Clique em "CRIAR TIMES E INICIAR"<br>
                                ‚öôÔ∏è Times s√£o criados automaticamente e balanceados<br>
                                üîí A lista de participantes ser√° bloqueada<br>
                                üèê Voc√™ ser√° levado para a aba <strong>Play</strong>
                            </div>
                        </div>

                        <!-- Controlar Jogo -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">4Ô∏è‚É£ Controlar o Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Na aba <strong>Play</strong> (bolinha verde quando ativo)
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                ‚ñ∂Ô∏è Clique em "INICIAR PARTIDA" para come√ßar<br>
                                üéÆ Clique em "CONTROLAR PLACAR" para editar pontos<br>
                                ‚ûï‚ûñ Use os bot√µes + e - para ajustar placar<br>
                                üîÑ Clique em "Nova Partida" ap√≥s vit√≥ria<br>
                                üèÅ Clique em "FINALIZAR JOGO" quando terminar
                            </div>
                        </div>

                        <!-- Finalizar -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">5Ô∏è‚É£ Finalizar Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Quando todas as partidas terminarem
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üèÜ Clique em "FINALIZAR JOGO"<br>
                                ‚úÖ O campe√£o ser√° registrado<br>
                                üìä O jogo sair√° da lista de dispon√≠veis<br>
                                üéâ Resultado aparece em "√öltimos Campe√µes"
                            </div>
                        </div>

                        <!-- Gerenciar Usu√°rios -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">6Ô∏è‚É£ Gerenciar Usu√°rios</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Acesse a gest√£o de usu√°rios pelo bot√£o <strong>USU√ÅRIOS</strong> no In√≠cio
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üë• Visualize todos os usu√°rios cadastrados<br>
                                üéØ Edite o n√≠vel de habilidade (1-6)<br>
                                üëë Troque perfil entre Admin e Jogador<br>
                                üí∞ Troque tipo de pagamento (Mensalista/Diarista)<br>
                                üìä Veja estat√≠sticas de cada usu√°rio<br>
                                ‚ö†Ô∏è Voc√™ pode editar apenas seu tipo de pagamento
                            </div>
                        </div>

                        <!-- Controlar Mensalidades -->
                        <div class="glass-card rounded-lg p-4">
                            <h4 class="text-orange-400 font-bold mb-2">7Ô∏è‚É£ Controlar Mensalidades</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Acesse pelo bot√£o <strong>MENSALIDADES</strong> no In√≠cio
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üíµ <strong>Definir Valor:</strong> Digite o valor total da mensalidade do m√™s<br>
                                üßÆ <strong>C√°lculo Autom√°tico:</strong> Sistema divide entre os mensalistas<br>
                                ‚úÖ <strong>Marcar Pagamentos:</strong> Clique em "Marcar como Pago" quando receber<br>
                                üìä <strong>Acompanhar:</strong> Veja quantos j√° pagaram em tempo real<br>
                                üìÖ <strong>Novo M√™s:</strong> Defina novo valor (pode ser diferente)
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function PlayerHelp() {
            return `
                <div class="space-y-6">
                    <!-- Suas Permiss√µes -->
                    <div class="bg-blue-500/10 border border-blue-500 rounded-xl p-4">
                        <h3 class="text-blue-400 font-bold text-lg mb-3">
                            <i class="fas fa-user mr-2"></i>Suas Permiss√µes de Jogador
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-blue-400 mt-1"></i>
                                <span>Participar de jogos dispon√≠veis</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-blue-400 mt-1"></i>
                                <span>Sair de jogos antes de iniciarem</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-blue-400 mt-1"></i>
                                <span>Ver times formados</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-blue-400 mt-1"></i>
                                <span>Acompanhar placar ao vivo</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-300">
                                <i class="fas fa-check text-blue-400 mt-1"></i>
                                <span>Ver suas estat√≠sticas</span>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <div class="flex items-start space-x-2 text-gray-400 text-sm mb-2">
                                <i class="fas fa-times text-red-400 mt-1"></i>
                                <span>Voc√™ n√£o pode criar jogos, adicionar visitantes ou controlar placar</span>
                            </div>
                            <div class="flex items-start space-x-2 text-gray-400 text-sm">
                                <i class="fas fa-times text-red-400 mt-1"></i>
                                <span>Voc√™ n√£o pode gerenciar usu√°rios ou controlar mensalidades</span>
                            </div>
                        </div>
                    </div>

                    <!-- Guia R√°pido -->
                    <div>
                        <h3 class="text-white font-bold text-lg mb-3">
                            <i class="fas fa-book mr-2 text-orange-400"></i>
                            Como Usar o App
                        </h3>

                        <!-- Participar -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">1Ô∏è‚É£ Participar de um Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Na aba <strong>In√≠cio</strong>, veja os jogos dispon√≠veis
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üìÖ Escolha o jogo pela data<br>
                                üë• Veja quantas vagas dispon√≠veis<br>
                                ‚úÖ Clique em "PARTICIPAR" para confirmar<br>
                                üëÅÔ∏è Clique no √≠cone olho para ver todos os participantes
                            </div>
                        </div>

                        <!-- Desistir -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">2Ô∏è‚É£ Desistir de um Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                S√≥ pode sair antes do jogo come√ßar
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üî¥ Clique em "SAIR" no card do jogo<br>
                                ‚ö†Ô∏è <strong>Importante:</strong> Ap√≥s o jogo iniciar, n√£o √© poss√≠vel sair!
                            </div>
                        </div>

                        <!-- Acompanhar -->
                        <div class="glass-card rounded-lg p-4 mb-3">
                            <h4 class="text-orange-400 font-bold mb-2">3Ô∏è‚É£ Acompanhar o Jogo</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Quando o admin iniciar o jogo
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üèê Uma bolinha verde aparecer√° na aba <strong>Play</strong><br>
                                üë• Veja os times formados<br>
                                üìä Acompanhe o placar em tempo real<br>
                                üèÜ Veja quem est√° ganhando cada partida
                            </div>
                        </div>

                        <!-- Estat√≠sticas -->
                        <div class="glass-card rounded-lg p-4">
                            <h4 class="text-orange-400 font-bold mb-2">4Ô∏è‚É£ Ver Estat√≠sticas</h4>
                            <p class="text-gray-300 text-sm mb-2">
                                Na aba <strong>Stats</strong>
                            </p>
                            <div class="bg-gray-700/50 rounded p-3 text-sm text-gray-400">
                                üéØ Veja seu n√≠vel atual<br>
                                üìà Acompanhe vit√≥rias e derrotas<br>
                                üèÜ Veja quantos campeonatos ganhou<br>
                                üìä Compare-se com outros jogadores no ranking
                            </div>
                        </div>
                    </div>

                    <!-- Navega√ß√£o -->
                    <div class="glass-card rounded-lg p-4">
                        <h4 class="text-white font-bold mb-3">
                            <i class="fas fa-compass mr-2 text-orange-400"></i>
                            Navega√ß√£o do App
                        </h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-gray-700/50 rounded p-3">
                                <i class="fas fa-home text-orange-400 mr-2"></i>
                                <strong class="text-white">In√≠cio</strong><br>
                                <span class="text-gray-400">Lista de jogos dispon√≠veis</span>
                            </div>
                            <div class="bg-gray-700/50 rounded p-3">
                                <i class="fas fa-calendar text-orange-400 mr-2"></i>
                                <strong class="text-white">Jogos</strong><br>
                                <span class="text-gray-400">Mesma tela do In√≠cio</span>
                            </div>
                            <div class="bg-gray-700/50 rounded p-3">
                                <i class="fas fa-play-circle text-orange-400 mr-2"></i>
                                <strong class="text-white">Play</strong><br>
                                <span class="text-gray-400">Jogo em andamento</span>
                            </div>
                            <div class="bg-gray-700/50 rounded p-3">
                                <i class="fas fa-chart-bar text-orange-400 mr-2"></i>
                                <strong class="text-white">Stats</strong><br>
                                <span class="text-gray-400">Suas estat√≠sticas</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showCreateGameModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn overflow-y-auto';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-md w-full my-8">
                    <h2 class="text-white font-bold text-2xl mb-4">
                        <i class="fas fa-plus-circle mr-2 text-orange-400"></i>
                        Criar Novo Jogo
                    </h2>
                    <form onsubmit="handleCreateGame(event)" class="space-y-4">
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-calendar mr-2"></i>Data do Jogo
                            </label>
                            <input type="date" id="game-date" required
                                class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-users mr-2"></i>M√°ximo de Jogadores
                            </label>
                            <input type="number" id="game-max" required min="8" max="32"
                                class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                value="16">
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-user-friends mr-2"></i>Jogadores por Time
                            </label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="team-size" value="4" class="hidden peer">
                                    <div class="custom-input peer-checked:border-orange-400 peer-checked:bg-orange-500/20 px-4 py-3 rounded-lg text-white text-center font-bold cursor-pointer hover:bg-white/10 transition">
                                        4 Jogadores
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="team-size" value="6" checked class="hidden peer">
                                    <div class="custom-input peer-checked:border-orange-400 peer-checked:bg-orange-500/20 px-4 py-3 rounded-lg text-white text-center font-bold cursor-pointer hover:bg-white/10 transition">
                                        6 Jogadores
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-bullseye mr-2"></i>Pontos por Partida
                            </label>
                            <select id="points-per-match" class="custom-input w-full px-4 py-3 rounded-lg text-white">
                                <option value="10">10 pontos</option>
                                <option value="12">12 pontos</option>
                                <option value="15">15 pontos</option>
                                <option value="21">21 pontos</option>
                                <option value="25" selected>25 pontos</option>
                            </select>
                        </div>
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="two-wins-rule" checked
                                    class="w-5 h-5 rounded border-2 border-gray-600 bg-gray-700 checked:bg-orange-500 checked:border-orange-500 cursor-pointer">
                                <div class="text-white">
                                    <div class="font-medium">
                                        <i class="fas fa-trophy mr-2 text-yellow-400"></i>
                                        Regra "Ganhou 2 Sai"
                                    </div>
                                    <div class="text-sm text-gray-400">Time que vencer 2 partidas sai da quadra</div>
                                    <div class="text-xs text-yellow-400 mt-1">
                                        ‚ö†Ô∏è S√≥ funciona com 4 times completos
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="this.closest('.fixed').remove()"
                                class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg text-white font-bold">
                                Cancelar
                            </button>
                            <button type="submit"
                                class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-check mr-2"></i>Criar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function handleCreateGame(event) {
            event.preventDefault();
            const date = document.getElementById('game-date').value;
            const maxPlayers = parseInt(document.getElementById('game-max').value);
            const teamSize = parseInt(document.querySelector('input[name="team-size"]:checked').value);
            const pointsPerMatch = parseInt(document.getElementById('points-per-match').value);
            const twoWinsRule = document.getElementById('two-wins-rule').checked;

            createGame(date, maxPlayers, teamSize, twoWinsRule, pointsPerMatch);
            showNotification('Jogo criado com sucesso! üéâ', 'success');
            document.querySelector('.fixed.inset-0').remove();
            render();
        }

        function showAddVisitorModal(gameId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-md w-full">
                    <h2 class="text-white font-bold text-2xl mb-4">
                        <i class="fas fa-user-plus mr-2 text-orange-400"></i>
                        Adicionar Visitante
                    </h2>
                    <form onsubmit="handleAddVisitor(event, ${gameId})" class="space-y-4">
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-user mr-2"></i>Nome do Visitante
                            </label>
                            <input type="text" id="visitor-name" required
                                class="custom-input w-full px-4 py-3 rounded-lg text-white"
                                placeholder="Ex: Carlos Oliveira">
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">
                                <i class="fas fa-star mr-2"></i>N√≠vel (1-6)
                            </label>
                            <div class="grid grid-cols-6 gap-2">
                                ${[1, 2, 3, 4, 5, 6].map(level => `
                                    <label class="cursor-pointer">
                                        <input type="radio" name="visitor-level" value="${level}"
                                            ${level === 3 ? 'checked' : ''} class="hidden peer">
                                        <div class="level-badge level-${level} w-full h-12 cursor-pointer
                                            opacity-50 peer-checked:opacity-100 peer-checked:ring-2 peer-checked:ring-orange-400
                                            hover:opacity-75 transition">
                                            ${level}
                                        </div>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="this.closest('.fixed').remove()"
                                class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg text-white font-bold">
                                Cancelar
                            </button>
                            <button type="submit"
                                class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-check mr-2"></i>Adicionar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function handleAddVisitor(event, gameId) {
            event.preventDefault();
            const name = document.getElementById('visitor-name').value;
            const level = document.querySelector('input[name="visitor-level"]:checked').value;

            if (addVisitor(gameId, name, level)) {
                showNotification(`Visitante ${name} adicionado! üë§`, 'success');
                document.querySelector('.fixed.inset-0').remove();

                // Atualizar o currentGame para refletir as mudan√ßas
                AppState.currentGame = AppState.games.find(g => g.id === gameId);
                render();
            } else {
                showNotification('N√£o foi poss√≠vel adicionar o visitante', 'error');
            }
        }

        function handleRemovePlayer(gameId, playerId) {
            const player = AppState.users.find(u => u.id === playerId);
            if (player && removePlayerFromGame(gameId, playerId)) {
                showNotification(`${player.name} removido do jogo`, 'info');

                // Atualizar o currentGame
                AppState.currentGame = AppState.games.find(g => g.id === gameId);
                render();
            }
        }

        // ============================================
        // FUN√á√ïES DE GERENCIAMENTO DE USU√ÅRIOS
        // ============================================

        function showEditUserModal(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-md w-full">
                    <h2 class="text-white font-bold text-2xl mb-4">
                        <i class="fas fa-edit mr-2 text-orange-400"></i>
                        Editar N√≠vel
                    </h2>
                    <div class="mb-4">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="text-3xl">${user.photo}</div>
                            <div>
                                <div class="text-white font-bold text-lg">${user.name}</div>
                                <div class="text-gray-400 text-sm">${user.email}</div>
                            </div>
                        </div>
                    </div>
                    <form onsubmit="handleEditUserLevel(event, ${userId})" class="space-y-4">
                        <div>
                            <label class="block text-white font-medium mb-3">
                                <i class="fas fa-layer-group mr-2"></i>Selecione o N√≠vel
                            </label>
                            <div class="grid grid-cols-3 gap-3">
                                ${[1, 2, 3, 4, 5, 6].map(level => `
                                    <label class="cursor-pointer">
                                        <input type="radio" name="user-level" value="${level}" ${user.level === level ? 'checked' : ''} class="hidden peer">
                                        <div class="level-badge level-${level} !w-full !h-16 !text-2xl peer-checked:ring-4 peer-checked:ring-white transition">
                                            ${level}
                                        </div>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="this.closest('.fixed').remove()"
                                class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg text-white font-bold">
                                Cancelar
                            </button>
                            <button type="submit"
                                class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                                <i class="fas fa-save mr-2"></i>Salvar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function handleEditUserLevel(event, userId) {
            event.preventDefault();
            const newLevel = parseInt(document.querySelector('input[name="user-level"]:checked').value);
            const user = AppState.users.find(u => u.id === userId);

            if (user) {
                user.level = newLevel;
                saveState();
                showNotification(`N√≠vel de ${user.name} atualizado para ${newLevel}! ‚úÖ`, 'success');
                document.querySelector('.fixed.inset-0').remove();
                render();
            }
        }

        function toggleUserRole(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;

            // Criar modal de confirma√ß√£o customizado
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn';

            const currentRole = user.role === 'admin' ? 'Admin' : 'Jogador';
            const newRole = user.role === 'admin' ? 'Jogador' : 'Admin';
            const newRoleValue = user.role === 'admin' ? 'player' : 'admin';

            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-md w-full">
                    <h2 class="text-white font-bold text-2xl mb-4">
                        <i class="fas fa-exchange-alt mr-2 text-yellow-400"></i>
                        Trocar Perfil
                    </h2>
                    <div class="mb-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="text-3xl">${user.photo}</div>
                            <div>
                                <div class="text-white font-bold text-lg">${user.name}</div>
                                <div class="text-gray-400 text-sm">${user.email}</div>
                            </div>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-300 text-center mb-2">
                                Perfil atual: <span class="text-white font-bold">${currentRole}</span>
                            </p>
                            <div class="flex items-center justify-center my-3">
                                <i class="fas fa-arrow-down text-orange-400 text-2xl"></i>
                            </div>
                            <p class="text-gray-300 text-center">
                                Novo perfil: <span class="text-white font-bold">${newRole}</span>
                            </p>
                        </div>
                    </div>
                    <p class="text-yellow-300 text-sm mb-4 text-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Tem certeza que deseja alterar o perfil?
                    </p>
                    <div class="flex gap-3">
                        <button onclick="this.closest('.fixed').remove()"
                            class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg text-white font-bold">
                            Cancelar
                        </button>
                        <button onclick="confirmToggleRole(${userId}, '${newRoleValue}')"
                            class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                            <i class="fas fa-check mr-2"></i>Confirmar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmToggleRole(userId, newRole) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.role = newRole;
                saveState();
                const roleName = newRole === 'admin' ? 'Admin' : 'Jogador';
                showNotification(`${user.name} agora √© ${roleName}! üîÑ`, 'success');
                document.querySelector('.fixed.inset-0').remove();
                render();
            }
        }

        function togglePaymentType(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;

            const currentType = user.paymentType === 'monthly' ? 'Mensalista' : 'Diarista';
            const newType = user.paymentType === 'monthly' ? 'Diarista' : 'Mensalista';
            const newTypeValue = user.paymentType === 'monthly' ? 'daily' : 'monthly';

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-fadeIn';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-6 max-w-md w-full">
                    <h2 class="text-white font-bold text-2xl mb-4">
                        <i class="fas fa-wallet mr-2 text-green-400"></i>
                        Trocar Tipo de Pagamento
                    </h2>
                    <div class="mb-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="text-3xl">${user.photo}</div>
                            <div>
                                <div class="text-white font-bold text-lg">${user.name}</div>
                                <div class="text-gray-400 text-sm">${user.email}</div>
                            </div>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-300 text-center mb-2">
                                Tipo atual: <span class="text-white font-bold">${currentType}</span>
                            </p>
                            <div class="flex items-center justify-center my-3">
                                <i class="fas fa-arrow-down text-green-400 text-2xl"></i>
                            </div>
                            <p class="text-gray-300 text-center">
                                Novo tipo: <span class="text-white font-bold">${newType}</span>
                            </p>
                        </div>
                    </div>
                    <p class="text-yellow-300 text-sm mb-4 text-center">
                        <i class="fas fa-info-circle mr-2"></i>
                        ${newTypeValue === 'monthly' ? 'O usu√°rio ser√° inclu√≠do no controle de mensalidades' : 'O usu√°rio ser√° removido do controle de mensalidades'}
                    </p>
                    <div class="flex gap-3">
                        <button onclick="this.closest('.fixed').remove()"
                            class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg text-white font-bold">
                            Cancelar
                        </button>
                        <button onclick="confirmTogglePaymentType(${userId}, '${newTypeValue}')"
                            class="btn-primary flex-1 py-3 rounded-lg text-white font-bold">
                            <i class="fas fa-check mr-2"></i>Confirmar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmTogglePaymentType(userId, newType) {
            const user = AppState.users.find(u => u.id === userId);
            if (user) {
                user.paymentType = newType;
                saveState();
                const typeName = newType === 'monthly' ? 'Mensalista' : 'Diarista';
                showNotification(`${user.name} agora √© ${typeName}! üí∞`, 'success');
                document.querySelector('.fixed.inset-0').remove();
                render();
            }
        }

        // ============================================
        // FUN√á√ïES DE CONTROLE DE MENSALIDADES
        // ============================================

        function saveMouthlyFee() {
            const value = parseFloat(document.getElementById('monthly-fee-value').value) || 0;
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

            AppState.monthlyFees[currentMonth] = value;
            saveState();

            showNotification(`Mensalidade de R$ ${value.toFixed(2)} salva para ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}! üí∞`, 'success');
            render();
        }

        function togglePaymentStatus(userId, month) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;

            if (!user.monthlyPayments) {
                user.monthlyPayments = {};
            }

            if (!user.monthlyPayments[month]) {
                user.monthlyPayments[month] = { paid: false };
            }

            user.monthlyPayments[month].paid = !user.monthlyPayments[month].paid;
            saveState();

            const status = user.monthlyPayments[month].paid ? 'PAGO ‚úì' : 'PENDENTE';
            showNotification(`${user.name} - ${status}`, user.monthlyPayments[month].paid ? 'success' : 'info');
            render();
        }

        // Sistema de Notifica√ß√µes
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-slideIn`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ============================================
        // RENDERIZA√á√ÉO
        // ============================================
        function render() {
            const app = document.getElementById('app');

            // Verificar autentica√ß√£o (exceto para login e register)
            if (!AppState.currentUser && AppState.currentView !== 'login' && AppState.currentView !== 'register') {
                AppState.currentView = 'login';
            }

            let content = '';

            switch (AppState.currentView) {
                case 'login':
                    content = LoginScreen();
                    break;
                case 'register':
                    content = RegisterScreen();
                    break;
                case 'dashboard':
                    content = DashboardScreen();
                    break;
                case 'game-detail':
                    content = GameDetailScreen();
                    break;
                case 'games':
                    content = DashboardScreen();
                    break;
                case 'teams':
                    content = TeamsScreen();
                    break;
                case 'play':
                    content = PlayScreen();
                    break;
                case 'match':
                    content = MatchScreen();
                    break;
                case 'stats':
                    content = StatsScreen();
                    break;
                case 'users':
                    content = UsersScreen();
                    break;
                case 'payments':
                    content = PaymentsScreen();
                    break;
                default:
                    content = LoginScreen();
            }

            app.innerHTML = content;

            // Remover bot√µes de ajuda existentes
            document.querySelectorAll('.help-button').forEach(btn => btn.remove());

            // Adicionar bot√£o de ajuda (exceto em login/register)
            if (AppState.currentUser && AppState.currentView !== 'login' && AppState.currentView !== 'register') {
                const helpButton = document.createElement('div');
                helpButton.className = 'help-button';
                helpButton.onclick = showHelpModal;
                helpButton.innerHTML = '<i class="fas fa-question text-white text-2xl"></i>';
                document.body.appendChild(helpButton);
            }
        }

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar estado dos cookies
            loadState();

            // Se tiver usu√°rio logado, vai para dashboard
            if (AppState.currentUser) {
                AppState.currentView = 'dashboard';
            }

            render();
        });

        // Detectar modo escuro
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</body>
</html>

